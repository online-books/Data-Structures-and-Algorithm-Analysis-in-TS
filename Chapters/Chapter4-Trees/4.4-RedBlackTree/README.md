<!-- @format -->

## 红黑树

红黑树是具有下列着色性质的二叉查找树

1.  每一个节点或者着成红色，或者着成黑色
2.  根是黑色的
3.  如果一个节点是红色的，那么它的子节点必须是黑色的
4.  从一个节点到一个 NULL 指针的每一条路径必须包含相同数目的黑色节点

着色法则的一个推论是，红黑树的高度最多是$2\log(N+1)$。对红黑树的操作在最坏的情形下花费$O(\logN)$。

### 自顶向下插入

---

将一个新项插入到树中时，通常把该项作为树叶放到书中。如果该项被涂成黑色，那么就违反了条件 4，因为这将会建立一条更长的黑节点的路径。因此，这一项必须涂成红色。如果它的父节点是黑色的，那么插入完成。如果它的父节点是红色的，那么我们得到连续红色节点，这就违反了条件 3。在这种情况下，我们必须调整该树以确保条件 3 满足且不引起条件 4 被破坏。用于完成这项任务的基本操作是颜色的改变和树的旋转。

如果父节点是红色的，那么有几种情形需要考虑。首先，假设这个父节点的兄弟是黑的(NULL 节点都是黑色的)。令$X$是新加的树叶，$P$是它的父节点，$S$是该父节点的兄弟节点，$G$是祖父节点。在这种情形只有$X$和$P$是红的，$G$是黑色的，否则就会在插入前有两个相连的红色节点，违反了红黑树的法则。$X$、$P$和$G$可以形成一个一字型或之字形链。下图指出当$P$是一个左儿子时，我们如何旋转该树。

第一种情形对应$P$和$G$之间的单旋转，而第二种情形对应双旋转，该双旋转首先在$X$和$P$间进行，然后在$X$和$G$间进行。当编写程序的时候，我们必须记录父节点、祖父节点，以及为了重新连接还要记录曾祖节点。

在两种情形下，子树的新根均被涂成黑色。因此，即使原来的曾祖是红色的，我们也排除了两个相连红节点的可能性。同样重要的是，这些旋转的结果是通向$A$,$B$和$C$诸路径上的黑节点个数保持不变。

在向下的过程中当我们看到一个节点$X$有两个红儿子的时候，我们让$X$成为红的而让它的两个儿子是黑的。下图显示出这种颜色翻转的现象，只有当$X$的父节点$P$也是红的时候，这种翻转将破坏红黑树的法则。但此时我们可以应用上图中适当的旋转，此时$X$的父节点的兄弟不可能是红的。特别地，如果在沿着树向下的过程中我们看到一个节点$Y$有两个红儿子，那么我们知道$Y$的孙子必然是黑的，由于$Y$的儿子也要变成黑的，甚至在可能发生的旋转之后，因此我们将不会看到两层上另外的红节点。这样，当我们看到$X$，若$X的父节点是红的，则$X 的父节点的兄弟不可能也是红的。

例如，我们要将 45 插入到图中的树上，在沿树向下的过程中，我们看到 50 有两个红儿子，因此，我们执行一次颜色翻转，使 50 为红的，40 和 55 是黑的。现在 50 和 60 都是红的，我们在 60 和 70 之间执行单旋转，使得 60 是 30 的右子树的黑根，而 70 和 50 都是红的。当我们到达树叶时，把 45 作为红节点插入，由于父节点是黑的，因此插入完成。最后得到的树如图所示。
